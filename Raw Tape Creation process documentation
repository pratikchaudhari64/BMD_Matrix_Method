Drip Monthly Data Tape Preparation
1.	Download all system generated data tapes from the auto-email sent on month end. 
2.	Concatenate all the tapes together to form â€œDrip Allâ€. 
3.	Move â€œExporter Countryâ€ field from end of tape to between â€œBuyerâ€ and â€œBuyer Countryâ€.
4.	Move â€œExporter IDâ€ and â€œBuyer IDâ€ fields from end of tape to between â€œBuyerâ€ and â€œExporter Countryâ€
5.	Move â€œBuyer Gradeâ€ field from end of tape to between â€œBuyer Countryâ€ and â€œProduct Exported Descâ€.
6.	Move â€˜Invoice Dateâ€™ field from end to between â€˜Grace Periodâ€™ and â€˜Anchor Event Dateâ€™
7.	Move â€œOther Adjustmentsâ€ between â€œSetup Fee Chargedâ€ and â€œTotal Feesâ€ 
8.	Remove following unnecessary columns from â€œDrip Allâ€:
a.	Product Operations Category
b.	Expected Tenor including Grace Period
c.	Comments for 30+ DPD RF Invoices
d.	Comments(Other Adjustments)
e.	Set offs
f.	Set off comments
g.	Sum of daily outstanding balance
h.	Native values â€“ Invoice value, Advance Value, Payment Received
i.	Approved LTM
j.	Weighted Average Invoice Duration
k.	Invoice IRR (Column to be added later from metabase query) 

9.	Add in following new derived columns to â€œDrip Allâ€:

a.	Create In Vasco? column
i.	Between â€˜Referenceâ€™ and â€˜Exporter Nameâ€™ 
ii.	Fill In Vasco? by vlookup from Vasco tracker
b.	Advance Rate (Actual) = Advanced Value USD / Net Invoice Value USD 
i.	Between â€˜Advanced Value USDâ€™ and â€˜Payment Received USDâ€™ 
c.	Open or Repaid Flag 
i.	Base it on invoice stage, not outstanding balance [Categorisation â€“ All except â€œSettledâ€ and â€œPending Settlementâ€ are open] Also "Auto-Settled" -ğŸ¡ª[OPEN]â€Auto-Settledâ€ stage did not exist in any of the 6 raw tapes THIS IS OKAY
ii.	Between â€˜LTMâ€™ and â€˜IRRâ€™/â€™Yieldâ€™ *
d.	Check â€œPayment Received USDâ€ for blanks and make 0
e.	The below 6 after 'Payment Received USD' : 
f.	Invoice Value Received USD = MIN(Payment Received USD, Net Invoice Value USD) 
g.	Principal/Advance Value Received USD = MIN(Payment Received USD, Advance Value USD) 
h.	Dilution on Invoice Value USD = IF(Open,0,Net Invoice Value â€“ Invoice Value Received) 
i.	Advance Value Dilution = IF(Open,0,Advanced Value USD â€“ Advanced Value Received)
j.	Outstanding Invoice Value USD = (Net Invoice Value USD - Invoice Value Received USD â€“ Dilution on Invoice Value USD) 
k.	Outstanding Principal Balance USD = (Advance Value Received USD â€“ Advanced Value USD â€“ Dilution on Advance Balance USD) 
l.	Create Invoice Yield at the very end 
m.	Add â€œModified Due Date Flagâ€ field after â€œInsurable Flagâ€ field[Added this column but not sure how it is to be populated] SAME AS 09/30 TAPE FOR NOW
n.	Add â€œModified Due Dateâ€ and â€œNew Due Dateâ€ fields after â€œDue Dateâ€ field [Added these two columns but not sure how theyâ€™re to be populated] SAME AS 09/30 TAPE FOR NOW

Delete repeated invoice ID 72 (Keep the one with the NAs) 
10.	VLOOKUP CORRECT BUYER NAMES FROM IDs USING this query [buyer ID #106215 from prev tape] 
11.	VLOOKUP CORRECT EXPORTER NAMES FROM IDs USING this query
12.	Make invoice ID 49 Flag â€œRepaidâ€ and Stage as â€œSettledâ€ 
13.	For Mx invoices, override Interest Rate and Step-up Interest Rate as: 
a.	New Interest Rate = Old Interest Rate * (Net Invoice Value USD ou / Advanced Value USD) 
b.	New Step Up Interest Rate = Old Step Up Interest Rate * (Net Invoice Value USD / Advanced Value USD) 

14.	Fill In Invoice Yield by Metabase query (effective_interest_rate) followed by vlookup and division by 100 
a.	Make Yield = NA for â€œOpenâ€ invoices [Few Open invoices had >0 IRR] what is the "stage"?-ğŸ¡ª[OPEN]stages are: Advanced/Overdue/ETD/FDA/partial adv./partial payment and the count of such is 211 Make IRR NA [Add before Open/Repaid flagâ€ column] 
15.	For invoices in â€œPending Settlementâ€ and â€œAuto-Settledâ€ stage, change NAs in Fees and Interest (using metabase query) [Did not have â€œAuto-Settledâ€ & â€œAuto-Advancedâ€ stage in the raw data][Payment received as in Data Tape and as from metabase query for invoices 21069 & 109800 do not match] what about "Pending Settlement" -ğŸ¡ª [OPEN]Raw tapes did have â€˜Pending Settlementâ€™ as a stage, and there were 29 such invoices for which the fees/interests were populated from metabase, but total payment received for 2/29 invoices did not match with the data tape. Also, there was no â€œAuto-Settledâ€  stage THIS IS OKAY
16.	Check for cases where factoring fee rate / interest rate / step-up interest rate is non-zero but corresponding actual $ value charged is 0 and vice-versa. (keeping in mind outstanding tenor, size etc.)
a.	Change Factoring Commission of invoices 18948, 17650,13196,11300, 11299, 9300, 9298, 3620, 2398 using this query. And dividing by 100 
b.	Sometimes for Repaid invoices show an interest/factoring fee charged and then increase adjustment amount (eg: 17421, 1757) 
17.	Make Invoice ID 9610 as â€˜Repaidâ€™ (stage = â€œSettledâ€, Yields = 0%) 
18.	Correct invoice dates of following invoices by reducing by 1 month: 
a.	Test failed: Invoice Date > First Advance Date
i.	4937
ii.	4779
iii.	4378
iv.	4319
v.	3270
vi.	3257
vii.	3256
viii.	2672
ix.	1137
x.	948
1.	10793 â€“ NO CHANGE Done [Followed the doc although the inv. Date>adv. Date]
19.	Make Total LTM as â€˜NAâ€™ where 0 
20.	Change stage from NPA to Overdue where <90 and >0 days DQ from Due Date (New) [inv. #19345, #16544, #16482, #15441, #15413, #15333 moved to â€œOverdueâ€]
21.	Change stage from NPA/Overdue to Advanced/ETD Check /GUD Check where <=0 days DQ from Due Date (New)  [7 invoices (20681, 19337, 16415, 16835, 15684, 15683, 15634), both moved to â€œAdvancedâ€ stage for the Anchor Event being â€œInvoice Dateâ€/â€BL Dateâ€] 
a.	Do ETD Check if Anchor Event is Discharge Date and dashboard agent check date > data tape date
b.	Do GUD Check if Anchor Event is GUD and dashboard agent check date > data tape date
22.	Change Stage from â€œAdvanced/GUD/ETDâ€ to â€œPartial Paymentâ€ if Open, not DQ and Payment >0 [No change here for  the â€œPayment Receivedâ€ was 0]
23.	Make Buyer Grade = â€œPendingâ€ where Buyer Grade = 11 and â€œNAâ€ where Blank 
a.	If existing old NPA buyer, then 11 might need to become NA and not â€œPendingâ€ (Eg: Bambino, East Ocean, Pure Life Foods)  
24.	Make Insurable Flag Blank where IF 
25.	Override columns Total Interest + Fees (With and Without Setup Fee) with summation formulae  
a.	Factoring + Interest + Step Up Interest + Setup + Adjustments [â€œNAâ€s in â€œOther Adjustmentsâ€ column to be replaced with?] NAs should be for open invoices, so let it be. -ğŸ¡ª [OPEN] The total fees (fees+interest etc.) calculation would show value error because text+string. Should I then add an â€˜IFERRORâ€™ clause? YES, MAKE NA
b.	Make NA for Open Invoices 
26.	Make Factoring Fee as â€˜NAâ€™ for invoices in stage â€œOpenâ€ 
27.	Manually populate Anchor Event Date where blank [done from prev. tape]
28.	Override Full Payment Date and Actual Outstanding Tenor for following two invoices: [Created a new col. â€œActual Outstanding tenor as (full payment date-first adv. Date) and made changes in it] There should be a field already. ğŸ¡ª[RESOLVED] Got it â€“ In the â€˜openâ€™ raw tapes â€˜Actual outstanding tenorâ€™ column is named as â€˜Expected outstanding tenorâ€™ whereas, it goes by the required name in the â€˜repaidâ€™ data tapes. 
a.	2364: Full Payment Date = 10/25/2018, Actual Outstanding Tenor = 51
b.	7694: Full Payment Date = 09/23/2019, Actual Outstanding Tenor = 132
29.	Override column â€œStep Up Interest Rate Tenor including Holiday Graceâ€ with below formula from dictionary:
a.	â€œNAâ€ for Open
b.	Max(0, Outstanding Tenor â€“ (Due Date (Old) â€“ First Advance Date + Grace Period)) for â€œRepaidâ€ 
30.	Rename currencies as usd -> USD, euro -> EUR and so on 
31.	Make â€œRelease Net Payment to Exporterâ€ and â€œActual Outstanding Tenorâ€ as NA (and not â€˜-â€˜) for all â€œOpenâ€ invoices. 
32.	Make â€œStageâ€ as â€œPrincipal Repaidâ€, and populate Principal Payment Date from dashboard for invoices where principal is fully repaid but interest + fees in pending. [found 7 such invoices]
33.	Add â€œExpected Tenor From Invoice Dateâ€ and â€œExpected Tenor From Advance Dateâ€ fields (Due Date (New) â€“ Invoice Date / First Advance Date ) 
34.	In the â€œCredit Limitâ€ sheet: 
a.	Keep only â€œInsured Limitâ€
b.	Delete IF (Delete rows where â€œInsured Limitâ€ is blank
c.	Add in Buyer ID column 
d.	Remove â€œAndre Prost Incâ€ and â€œHathi Foodsâ€ (UAE invoice buyers) 
e.	Correct Sl Nos by dragging and autofill 

35.	Run the following tests on the data: 
a.	Ranges of all columns
b.	Nulls and negatives (refer to  the google sheet)
c.	Date chronology 
d.	Nothing in the future
e.	Total count of invoices, Mx/Ind split, RF/IF split with dashboard/metabase
f.	Anchor Event Dates when Anchor Event is BL/Invoice Date
g.	Fees/Interest, Yield, Outstanding Balance, Stage when invoice is â€œOpenâ€
h.	Quick cross checks with past formatted data tapes to see increase/decrease etc. 

36.	Change formatting by copying pasting into latest â€œFormatted Tape Skeletonâ€ file 

37.	In the â€œCashflow Statementâ€ sheet, add in:

a.	Cashflow USD = Cashflow*Conversion
b.	Cashflow Month = EOMONTH(Cashflow Date,-1)+1
c.	Origination Month = EOMONTH(First Invoice Advanced Date,-1)+1






